{# templates/lucky/home.html.twig #}
{% extends 'base.html.twig' %}
{% block title %}Галерея{% endblock %}
{% block javascripts %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/combine/npm/lightgallery@2.3.0,npm/lightgallery@2.3.0/plugins/zoom/lg-zoom.umd.min.js,npm/lightgallery@2.3.0/plugins/thumbnail/lg-thumbnail.umd.min.js"></script>
{% endblock %}
{% block body %}
    <div class="content">
        <div class="container">
            <h1 class="header">Тестовое задание с галереей</h1>
            {% if is_granted('ROLE_ADMIN') %}
                <span>Вы залогинены.</span>
                <a href="/logout">Выйти</a>
                <form method="POST" action="{{ path('app_gallery_upload') }}" enctype="multipart/form-data">
                    <input type="file" name="image" accept="image/png,image/jpeg">
                    <button type="submit">Загрузить</button>
                </form>
            {% else %}
                <a href="/login">Войти,</a> <span>чтобы редактировать галерею.</span>
            {% endif %}
            <!-- checking if we parsed images through and if we did, we create inline gallery -->
            {% if images %}
                <div id="inline-gallery-container" class="inline-gallery-container"></div>
            {% else %}
                <span>Сейчас галерея пуста! Добавьте файл, чтобы увидеть её.</span>
            {% endif %}
        </div>
    </div>
    <script type="text/javascript">
        const lgContainer = document.getElementById('inline-gallery-container');
        //adding remove button but only if user is admin
        {% if is_granted('ROLE_ADMIN') %}
        lgContainer.addEventListener('lgInit', (event) => {
            let updateSlideInstance = event.detail.instance;
           const deleteBtn =
                '<button type="button" aria-label="Remove slide" class="lg-icon" id="lg-delete"><img src="{{ asset('images/trash-can.png') }}"></button>';
            updateSlideInstance.outer.find('.lg-toolbar').append(deleteBtn);
        });
        {% endif %}



        const inlineGallery = lightGallery(lgContainer, {
            container: lgContainer,
            dynamic: true,
            // Turn off hash plugin in case if you are using it
            // as we don't want to change the url on slide change
            hash: false,
            // Do not allow users to close the gallery
            closable: false,
            // Add maximize icon to enlarge the gallery
            showMaximizeIcon: true,
            // Append caption inside the slide item
            // to apply some animation for the captions (Optional)
            appendSubHtmlTo: '.lg-item',
            // Delay slide transition to complete captions animations
            // before navigating to different slides (Optional)
            // You can find caption animation demo on the captions demo page
            slideDelay: 400,
            dynamicEl: [
                {% for image in images %}
                {
                    src: '{{ asset(image.directory) }}',
                    thumb: '{{ asset(image.directory) }}',
                },
                {% endfor %}
            ],
        });

        // Since we are using dynamic mode, we need to programmatically open lightGallery
        inlineGallery.openGallery();
    </script>

{% endblock %}